# Fly.io configuration for Kafka + Zookeeper
app = 'pipeline-kafka'
primary_region = 'sjc'

[build]
  dockerfile = "Dockerfile"

[env]
  KAFKA_BROKER_ID = '1'
  KAFKA_ZOOKEEPER_CONNECT = 'localhost:2181'
  KAFKA_LISTENERS = 'PLAINTEXT://0.0.0.0:9092'
  KAFKA_ADVERTISED_LISTENERS = 'PLAINTEXT://pipeline-kafka.internal:9092'
  KAFKA_LISTENER_SECURITY_PROTOCOL_MAP = 'PLAINTEXT:PLAINTEXT'
  KAFKA_INTER_BROKER_LISTENER_NAME = 'PLAINTEXT'
  KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR = '1'
  KAFKA_TRANSACTION_STATE_LOG_MIN_ISR = '1'
  KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR = '1'
  KAFKA_AUTO_CREATE_TOPICS_ENABLE = 'true'

[[services]]
  protocol = 'tcp'
  internal_port = 9092

[[vm]]
  memory = '2gb'
  cpu_kind = 'shared'
  cpus = 1

[mounts]
  source = "kafka_data"
  destination = "/var/lib/kafka/data"
