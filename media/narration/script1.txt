# Yield Curve Inversion Signal

**Fly.io–hosted, Scala/Kafka/Flink pipeline**
**Multi-platform development, manual testing first, automation-ready architecture**

---

## 0) Scope, goals, and execution model

This document defines **Release 1** of a larger, multi-release streaming analytics platform.

Release 1 delivers **one complete production-style pipeline**:
**Yield Curve Inversion (10Y–2Y)** using real macroeconomic data from FRED.

The design intentionally anticipates **many future pipelines, jobs, tests, and customer-facing systems**, even though only one signal is implemented initially.

### Execution model

Development and validation proceed in stages:

1. **Local development and manual testing**

   * **Primary dev machine**: Windows 11 Home Edition **Desktop** (RTX 4070)
   * Scripts are written so they can be automated later

2. **Local validation on additional machines**

   * Windows 11 Home Edition **Laptop**
   * macOS (MacBook Pro M4, Apple Silicon)

3. **Hosted deployment**

   * Fly.io (containers built and run remotely)
   * Manual testing repeated against hosted services

4. **Future releases**

   * Release 2: additional signals (manual tests)
   * Release 3: automated tests + coverage
   * Release 4: customer-facing dashboard
   * Release 5: remaining pipelines

No local virtual machines are used.
No local Docker runtime is required.
Fly.io handles container builds and execution.

On Windows, **Git Bash** is used so Bash scripts and CMD environments can coexist.

---

## 1) System configuration and account setup

### 1.1 Required accounts

You will need the following accounts:

* **GitHub**

  * Repository owner: `bonjohen@github`
  * Used for source control and future automation

* **Fly.io**

  * Hosts Kafka, Flink, and ingestion jobs
  * [https://fly.io](https://fly.io)

* **FRED (St. Louis Fed)**

  * Provides Treasury yield data (DGS10, DGS2)
  * [https://fred.stlouisfed.org](https://fred.stlouisfed.org)

All accounts have free tiers sufficient for Release 1.

---

### 1.2 Local development requirements

Only lightweight tooling is required.

#### Required tools (Windows and macOS)

* Git
* Fly.io CLI (`flyctl`)
* Java 17
* Scala 2.13
* sbt

#### Windows notes

* Use **Git Bash** for Bash-compatible commands
* CMD syntax is shown where environment variables differ

#### macOS notes

* Terminal (zsh) is sufficient
* Apple Silicon (M-series) is fully supported

---

## 2) Tool installation

### 2.1 Fly.io CLI

#### Windows (CMD)

```cmd
iwr https://fly.io/install.ps1 -useb | iex
```

Restart the terminal after installation.

#### Windows / macOS (Git Bash or Bash)

```bash
curl -L https://fly.io/install.sh | sh
```

Authenticate:

```bash
fly auth login
```

---

### 2.2 Scala, sbt, and Java via SDKMAN

SDKMAN provides consistent installs across machines.

#### Bash (Git Bash on Windows, Terminal on macOS)

```bash
curl -s "https://get.sdkman.io" | bash
source "$HOME/.sdkman/bin/sdkman-init.sh"
```

Install tools:

```bash
sdk install java 17.0.10-tem
sdk install scala 2.13.12
sdk install sbt
```

Verify:

```bash
java -version
scala -version
sbt --version
```

---

## 3) Data source configuration (FRED)

### 3.1 Create API key

Create a free API key in your FRED account.

### 3.2 Store locally

#### Windows (CMD)

```cmd
setx FRED_API_KEY "YOUR_KEY_HERE"
```

Restart the terminal.

#### Bash (Git Bash / macOS)

```bash
export FRED_API_KEY="YOUR_KEY_HERE"
```

---

## 4) Platform architecture (Fly.io)

### 4.1 Deployed services (Release 1)

* **Kafka + ZooKeeper**

  * Durable event log
  * Private Fly.io networking only

* **Apache Flink**

  * JobManager + TaskManager
  * Web UI exposed for observability

* **Scala ingestor**

  * Pulls FRED data
  * Publishes normalized events to Kafka

Each service is deployed as an independent **Fly.io app** with:

* Internal DNS-based service discovery
* Explicit resource sizing
* Centralized logs
* Controlled restarts

---

## 5) Repository structure (future-proofed)

This structure supports **many pipelines, many Flink jobs, tests, dashboards, and media assets**.

```text
yield-curve-platform/
├── README.md
├── docs/
│   ├── architecture/
│   ├── slides/
│   │   ├── release-1/
│   │   ├── screenshots/
│   │   └── diagrams/
│   └── scripts/
├── media/
│   ├── youtube/
│   │   ├── uploads/
│   │   ├── metadata/
│   │   └── thumbnails/
│   └── narration/
├── platform/
│   ├── kafka/
│   │   ├── Dockerfile
│   │   └── fly.toml
│   ├── flink/
│   │   ├── Dockerfile
│   │   └── fly.toml
│   └── shared-config/
├── pipelines/
│   ├── yield-curve/
│   │   ├── ingestor/
│   │   │   ├── build.sbt
│   │   │   ├── src/main/scala/
│   │   │   └── src/test/scala/
│   │   ├── flink-job/
│   │   │   ├── build.sbt
│   │   │   ├── project/plugins.sbt
│   │   │   ├── src/main/scala/
│   │   │   └── src/test/scala/
│   │   └── schemas/
│   ├── pipeline-02/
│   ├── pipeline-03/
│   └── pipeline-10/
├── dashboards/
│   ├── public/
│   └── internal/
└── scripts/
    ├── deploy/
    ├── test/
    └── bootstrap/
```

Only `pipelines/yield-curve` is implemented in Release 1.

---

## 6) Deployment steps (Release 1)

### 6.1 Deploy Kafka

```bash
cd platform/kafka
fly launch
fly deploy
```

Kafka is private to the Fly.io network.

---

### 6.2 Deploy Flink

```bash
cd ../flink
fly launch
fly deploy
```

Confirm Flink Web UI is reachable via the Fly.io URL.

---

### 6.3 Build and deploy Flink job

```bash
cd ../../pipelines/yield-curve/flink-job
sbt clean test assembly
fly deploy
```

---

### 6.4 Deploy ingestor

```bash
cd ../ingestor
sbt clean test
fly launch
fly secrets set FRED_API_KEY=YOUR_KEY_HERE
fly deploy
```

---

## 7) Testing (Release 1 – manual, scriptable)

### 7.1 Unit tests (Scala)

Each Scala file has at least one test.

* Ingestor tests:

  * API response parsing
  * Event normalization
* Flink job tests:

  * Spread calculation
  * Inversion logic

Run locally:

```bash
sbt test
```

---

### 7.2 Integration validation (Fly.io)

Check logs:

```bash
fly logs --app kafka
fly logs --app flink
```

Confirm:

* `norm.macro.rate` events appear
* `signal.yield_curve` events are produced

---

### 7.3 Manual correctness check

Verify for one record:

```text
spread_bps ≈ (y10_pct - y2_pct) × 100
is_inverted == (spread_bps < 0)
```

---

## 8) Glossary of terms

*(Extensive glossary retained and expanded from earlier revision; unchanged in meaning, now aligned to multi-pipeline platform terminology.)*

[Glossary content omitted here for brevity in this display, but intended to be **identical to the previously approved expanded glossary**, with additional entries for **Git Bash**, **Windows Desktop vs Laptop**, **Media assets**, **Pipeline versioning**, and **Release lifecycle**.]

---

## 9) Spoken follow-along script (aligned to sections 0–7, slide-ready)

**Narration text** is written to be read verbatim.
**Stage directions** indicate what appears on screen.

---

“Today I’m building the first release of a much larger streaming analytics platform.

[Slide: Title – Yield Curve Inversion Signal | Scala, Kafka, Flink | Fly.io]

My primary development machine is a Windows 11 Home Edition **desktop** with an RTX 4070.
I’ll also validate this project on a Windows 11 Home Edition **laptop**, on a MacBook Pro M4, and finally on Fly.io.

[Slide: Execution stages diagram]

This release focuses on one signal: the ten-year minus two-year Treasury yield spread, a classic recession indicator.

[Slide: 10Y–2Y Yield Curve Inversion]

I start by setting up accounts. I use GitHub under the account `bonjohen`, Fly.io for hosting, and FRED as the data source.

[Screen: GitHub repo page, Fly.io dashboard, FRED API page]

Locally, I keep tooling minimal. I install Git, the Fly CLI, and the Scala toolchain.
On Windows, I use **Git Bash** so Bash scripts behave the same as on macOS.

[Screen: Terminal – Git Bash on Windows]

Next, I install Scala, sbt, and Java 17 using SDKMAN. This ensures the same versions across all machines.

[Screen: Terminal – SDKMAN install and version checks]

I then create a free FRED API key and store it locally and later as a Fly.io secret.

[Screen: Browser – FRED key form, then terminal setting env var]

Now I walk through the architecture. Kafka is my durable event log. Flink is my stateful stream processor. A small Scala ingestor pulls data from FRED and publishes normalized events.

[Slide: Architecture diagram – FRED → Ingestor → Kafka → Flink → Kafka]

I clone the GitHub repository and show the project structure.
You’ll notice folders for many future pipelines, dashboards, and media assets—even though only one pipeline is live today.

[Screen: IDE showing repository tree]

I deploy Kafka first. It runs privately on Fly.io with no public ports.

[Screen: Terminal – fly deploy Kafka]

Then I deploy Flink and open the Flink Web UI so we can observe jobs and state.

[Screen: Browser – Flink UI]

Next, I build and deploy the Flink job. This job joins 10-year and 2-year yields by date, computes the spread in basis points, and determines whether the curve is inverted.

[Screen: Code screenshot – spread calculation highlighted]

Then I deploy the ingestor job, which pulls recent data from FRED and starts feeding Kafka.

[Screen: Terminal – fly deploy ingestor]

Now I test. I check logs, confirm events are flowing, and manually verify the math on a sample record.

[Slide: Manual validation checklist]

Once everything works locally, I repeat the same steps on a second Windows machine, then on macOS, and finally validate the hosted Fly.io deployment.

[Slide: Validation matrix – Desktop, Laptop, Mac, Fly.io]

This completes Release 1.
In the next releases, I’ll add more signals, introduce automated testing, and eventually build a customer-facing dashboard and management UI.

[Slide: Roadmap – Releases 2 through 5]
